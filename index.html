<html>
	<head>
		<title>Canvas Mobile Game</title>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-title" content="Canvas Mobile Game">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
		<style>
			html, body {
				overflow: hidden;
			}

			body {
				position: fixed;
				top: 0;
				left: 0;
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
				background-color: #000;

				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;

				-webkit-tap-highlight-color: transparent;
				-webkit-touch-callout: none;
			}

			#workspace-wrapper {
				position: relative;
				width: 100%;
				height: 100%;
			}

			#start-button {
				position: absolute;
				width: 100%;
				height: 100%;
				color: #fff;
				background-color: rgba(100, 100, 100, 0.5);
				font-size: 30px;
				text-decoration: underline;
			}

			#workspace-wrapper canvas {
				position: absolute;
				top: 0;
				left: 0;
			}

			#left-joystick {
				position: absolute;
				bottom: 60px;
				left: 60px;
			}

			#right-joystick {
				position: absolute;
				bottom: 60px;
				right: 60px;
			}

			.joystick {
				width: 75px;
				height: 75px;
				border: 2px solid #77f;
				border-radius: 50%;

				display: grid;
				grid-template-columns: repeat(3, 14px);
				grid-template-rows: repeat(3, 14px);
				grid-template-areas:
					"......  up  ......"
					"left   ....  right"
					"...... down ......";
				align-content: center;
				justify-content: center;
				grid-gap: 8px;
			}

			.arrow {
				width: 0;
				height: 0;
				border: 7px solid transparent;
			}
			.arrow-up {
				grid-area: up;
				border-bottom-color: #77f;
			}
			.arrow-right {
				grid-area: right;
				border-left-color: #77f;
			}
			.arrow-down {
				grid-area: down;
				border-top-color: #77f;
			}
			.arrow-left {
				grid-area: left;
				border-right-color: #77f;
			}
		</style>
	</head>
	<body>
		<div id="workspace-wrapper">
			<canvas id="map">Your browser really sucks...</canvas>
			<canvas id="players">Your browser really sucks...</canvas>
			<div id="left-joystick" class="joystick">
				<div class="arrow arrow-up"></div>
				<div class="arrow arrow-right"></div>
				<div class="arrow arrow-down"></div>
				<div class="arrow arrow-left"></div>
			</div>
			<div id="right-joystick" class="joystick">
				<div class="arrow arrow-up"></div>
				<div class="arrow arrow-right"></div>
				<div class="arrow arrow-down"></div>
				<div class="arrow arrow-left"></div>
			</div>
			<button id="start-button">Click for Full Screen</button>
		</div>

		<script type="module" crossorigin="anonymous">
			import Game from './game.js';

			const BOTTOM_MAP = [
				[  't', 'tr', 'tl','otl',     ],
				[     ,  'r',  'l','obr',  'b'],
				[     ,'otr','otl','otr',  't'],
				[  'b',  'b',  'b','obl',     ],
				[  't', 'tr', 'tl','otl',     ],
				[     ,  'r',  'l','obr',  'b'],
				[     ,'otr','otl','otr',  't'],
				['obr',  'b',  'b',  'b','obl']
			];

			const TOP_MAP = [
				['tl',  't',  't', 'tr', 'tl',  't',  't',  't',  't', 'tr'],
				[ 'l',     ,     ,  'r',  'l',     ,'obr','obl',     ,  'r'],
				[ 'l',     ,     ,'otr','otl',     ,  'r', 'bl','obl',  'r'],
				[ 'l','obr','obl',     ,     ,     ,'otr',  't','otl',  'r'],
				[ 'l',  'r',  'l',     ,     ,     ,     ,     ,     ,  'r'],
				[ 'l','otr','otl',     ,'obr',  'b','obl',     ,     ,  'r'],
				[ 'l',     ,     ,     ,  'r',  'f',  'l',     ,     ,  'r'],
				['bl',  'b',  'b',  'b', 'br',  'f', 'bl',  'b','obl',  'r'],
				['tl',  't',  't', 'tr', 'tl',  't',  't',  't','otl',  'r'],
				[ 'l',     ,     ,  'r',  'l',     ,'obr','obl',     ,  'r'],
				[ 'l',     ,     ,'otr','otl',     ,  'r', 'bl','obl',  'r'],
				[ 'l','obr','obl',     ,     ,     ,'otr',  't','otl',  'r'],
				[ 'l',  'r',  'l',     ,     ,     ,     ,     ,     ,  'r'],
				[ 'l','otr','otl',     ,'obr',  'b','obl',     ,     ,  'r'],
				[ 'l',     ,     ,     ,  'r',  'f',  'l',     ,     ,  'r'],
				['bl',  'b',  'b',  'b', 'br',  'f', 'bl',  'b',  'b', 'br']
			];

			const elMap = document.getElementById('map');
			const elPlayers = document.getElementById('players');
			const elJoystickShoot = document.getElementById('right-joystick');
			const elJoystickMove = document.getElementById('left-joystick');

			const game = Game({
				bottomMapData: BOTTOM_MAP,
				topMapData: TOP_MAP,
				elMap,
				elPlayers,
				elJoystickShoot,
				elJoystickMove
			}).resize(window.innerWidth, window.innerHeight);

			addEventListener('keydown', e => {
				if(e.repeat) return;

				if(e.key === 'Enter') {
					game.toggle();
				}
			});

			addEventListener('resize', () => {
				game.resize(window.innerWidth, window.innerHeight);
			});

			function requestFullscreen() {
				const docEl = document.documentElement;
				const fullscreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullscreen || docEl.msRequestFullscreen;

				fullscreen.call(docEl);
			}

			document.getElementById('start-button')
				.addEventListener('click', ({ target }) => {
					target.parentNode.removeChild(target);
					requestFullscreen();
					game.start();
				});
		</script>
	</body>
</html>
